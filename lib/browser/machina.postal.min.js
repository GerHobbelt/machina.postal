/*
 machina.postal
 Author: Jim Cowart (http://freshbrewedcode.com/jimcowart)
 License: Dual licensed MIT (http://www.opensource.org/licenses/mit-license) & GPL (http://www.opensource.org/licenses/gpl-license)
 Version 0.2.2
 */
(function(e,t,n){typeof define=="function"&&define.amd?define(["machina","postal"],function(r,i){return n(r,i,e,t)}):n(e.machina,e.postal,e,t)})(this,document,function(e,t,n,r,i){var s={transitioned:function(e){return{fromState:e[0],toState:e[1]}},transitioning:function(e){return{fromState:e[0],toState:e[1]}}},o=e.bus={channels:{},config:{handlerChannelSuffix:"",eventChannelSuffix:".events"},wireHandlersToBus:function(e,t){o.channels[t]._subscriptions.push(o.channels[t].subscribe("#",function(t,n){e.handle.call(e,n.topic,t,n)}))},wireEventsToBus:function(e,t){var n=o.channels[t].eventPublisher=function(){var e=Array.prototype.slice.call(arguments,0),n=e[0].toLowerCase();try{var r=s.hasOwnProperty(n)?s[n](e.slice(1)):e[1];o.channels[t].publish({topic:e[0],data:r||{}})}catch(i){console&&typeof console.log!="undefined"&&console.log(i.toString())}};e.on("*",n)},wireUp:function(e){var n=e.namespace+o.config.handlerChannelSuffix,r=e.namespace+o.config.eventChannelSuffix;o.channels[n]=t.channel({channel:n}),o.channels[r]=t.channel({channel:r}),o.channels[n]._subscriptions=[],o.wireHandlersToBus(e,n),o.wireEventsToBus(e,r)}};e.on("newFsm",o.wireUp)})