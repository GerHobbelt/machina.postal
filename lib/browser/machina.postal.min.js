(function(a,b,c){typeof define=="function"&&define.amd?define(["machina","postal"],function(d,e){return c(d,e,a,b)}):c(a.machina,a.postal,a,b)})(this,document,function(a,b,c,d,e){var f=a.bus={channels:{},config:{handlerChannelSuffix:"",eventChannelSuffix:".events"},wireHandlersToBus:function(a,b){f.channels[b]._subscriptions.push(f.channels[b].subscribe("*",function(b,c){a.handle.call(a,c.topic,b,c)}))},wireEventsToBus:function(a,b){var c=f.channels[b].eventPublisher=function(){try{f.channels[b].publish({topic:arguments[0],data:arguments[1]||{}})}catch(a){console&&typeof console.log!="undefined"&&console.log(a.toString())}};a.on("*",c)},wireUp:function(a){var c=a.namespace+f.config.handlerChannelSuffix,d=a.namespace+f.config.eventChannelSuffix;f.channels[c]=b.channel({channel:c}),f.channels[d]=b.channel({channel:d}),f.channels[c]._subscriptions=[],f.wireHandlersToBus(a,c),f.wireEventsToBus(a,d)}};a.on("newFsm",f.wireUp)})